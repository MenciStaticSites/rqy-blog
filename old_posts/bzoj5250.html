<!doctype html>
<html lang="zh-Hans-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>BZOJ5250 [多省联考2018] 秘密袭击 - 清芷的博客</title>
        <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon_3f3okc0t0smnz.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32_lrgcr2u2dgnr.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16_1siqrekx8ykol.png">
        <link rel="manifest" href="../site.webmanifest">
        <link rel="stylesheet" href="../css/fifthave_3dfyc7189qcwg.css" />
        <link rel="stylesheet" href="../css/syntax_lf612iqmmilx.css" />
        <link rel="stylesheet" href="../css/banana_2lzbro8offw8.css" />
        <link rel="stylesheet" href="../css/katex.min_1koofb1j5udh9.css" />
        <script src="../js/jquery-3.6.1.min_1udo1bomfn0oe.js"></script>
        <script src="../js/proof-collapse_rlvnn55bzvd0.js"></script>
        <script src="../js/table-of-contents_35en0xznwr03i.js"></script>
        
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>

        <!-- To automatically render math in text elements, include the auto-render extension: -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                renderMathInElement(document.body, {
                    // customised options
                    // ? auto-render specific keys, e.g.:
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\(', right: '\\)', display: false},
                        {left: '\\[', right: '\\]', display: true}
                    ],
                    // ? rendering keys, e.g.:
                    throwOnError : false
                });
            });
        </script>
        
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="..">清芷的博客</a>
            </div>
            <nav>
                <a href="..">首页</a>
                <a href="../about.html">关于</a>
                <a href="../contact.html">联系</a>
                <a href="../friends.html">友链</a>
                <a href="../archive.html">归档</a>
            </nav>
        </header>

        <main role="main">
            <h1>BZOJ5250 [多省联考2018] 秘密袭击</h1>
            <div class="info">
    
    2018 年 04 月  8 日发布.
    
</div>

<h3 id="description">Description</h3>
<p>一棵 $n$ 个点的树，第 $i$ 个点有点权 $d_i$ 。给定一个数 $k$ ，求所有 [ 大小不小于 $k$ 的连通块中的第 $k$ 大的点权 ] 的和。</p>
<p>$k \leqslant n \leqslant 1666$ ，点权最大值 $W \leqslant 1666$ 。</p>
<!--more-->
<h3 id="solution">Solution</h3>
<p>如果我们对于每一个 $w=1\dots W$ 都求出它作为第 $k$ 大的方案数，那就做完了。</p>
<p>显然，第 $k$ 大的数是 $w$ 的方案数，相当于其大于等于 $w$ 的方案数，减去其大于等于 $w+1$ 的方案数。</p>
<p>令 $a_i$ 表示第 $k$ 大的数大于等于 $i$ 的方案数，则答案即为 $\sum_{i=1}^W i(a_i-a_{i+1})$ ，容易发现它就等于 $\sum_{i=1}^W a_i$ 。</p>
<p>先考虑暴力 dp 。考虑枚举 $i$ 之后如何求 $a_i$ 。</p>
<p>显然，第 $k$ 大的数大于等于 $i$ ，等价于大于等于 $i$ 的个数至少有 $k$ 个。</p>
<p>我们令 $f_{a,b}$ 表示在 $a$ 的子树中选出 $b$ 一个连通块，连通块必须包含 $a$ 且大于等于 $i$ 的数恰好有 $b$ 个的方案数。</p>
<p>转移时在树上跑一遍背包即可。求 $a_i$ 就可以直接把所有 $f_{a, b} (b \ge k)$ 加起来。<del>卡一下常就能AC了</del></p>
<p>考虑如何加速 dp 。</p>
<p>令 $F_a(x)=\sum_b f_{a, b}x^b$ ，即 $f_a$ 的生成函数。</p>
<p>树上背包的卷积形式相当于</p>
<p>$$F_a(x)=\left(\prod_{b\in son_a}(1+F_b(x))\right)*\begin{cases}1 &amp; d_a \ge i\\x&amp;d_a\lt i\end{cases}$$</p>
<p>求答案时可以令 $G_a(x)$ 表示 $a$ 子树里所有 $F_a(x)$ 的和，然后求 $G_{root}(x)$ 的第 $k\dots n$ 项和。</p>
<p>如果我们只需要给定 $x_0$ ，求出 $F_a(x_0), G_a(x_0)$ ，那么可以直接 $O(n)$ DP 。</p>
<p>那么显然我们可以利用拉格朗日插值法，通过 $n+1$ 次 DP 插值出答案。<del>然而这并没有优化复杂度甚至还会更慢</del></p>
<p>那么我们看一看目前的 DP 代码，它大概长这个样：</p>
<pre class="text"><code>DP(a, i, x0)
  (f, g) = (1, 0)
  for b in son(a)
    (fb, gb) = DP(b, i, x0)
    (f, g) = (f * (1 + fb), g + gb)
  if d[a] &gt;= i
    (f, g) = (f * x0, g)
  (f, g) = (f, g + f)
  return (f, g)</code></pre>
<p>对于每一个 $x_0$ ，最后的答案好像没有什么关联。那么能不能通过 $i$ 这一维来优化呢？</p>
<p>假设我们只枚举 $x_0$ ，而每次 DP 时求出 $i$ 取每一个值的时候的答案。</p>
<ul>
<li><code>(f, g) = (1, 0)</code> -&gt; 整体赋值</li>
<li><code>(f, g) = (f * (1 + fb), g + gb)</code> -&gt; 对应项合并</li>
<li><code>if d[a] &gt;= i / (f, g) = (f * x0, g)</code> -&gt; 第 $1$ 到第 $d_a$ 项打标记</li>
<li><code>(f, g) = (f, g + f)</code> -&gt; 整体打标记</li>
</ul>
<p>所以说可以利用线段树维护 DP 值。</p>
<p>打标记时 <del>xjb搞</del> 一番推导之后我们得出标记是这么个形式： <code>(f, g) -&gt; (x + y*f, g + z + w*f)</code> 。</p>
<p>完了。<del>线段树合并为什么不讲？因为讲不明白，自己看代码好了。</del></p>
<h3 id="code">Code</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cctype&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> readInt<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> c<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">(!</span>isdigit<span class="op">(</span>c <span class="op">=</span> getchar<span class="op">()));</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">do</span> ans <span class="op">=</span> ans <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> c <span class="op">-</span> <span class="ch">'0'</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">(</span>isdigit<span class="op">(</span>c <span class="op">=</span> getchar<span class="op">()));</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ans<span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> N <span class="op">=</span> <span class="dv">2000</span><span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> mod <span class="op">=</span> <span class="dv">64123</span><span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> LL<span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">,</span> k<span class="op">,</span> W<span class="op">,</span> d<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pre<span class="op">[</span>N<span class="op">],</span> nxt<span class="op">[</span>N <span class="op">*</span> <span class="dv">2</span><span class="op">],</span> to<span class="op">[</span>N <span class="op">*</span> <span class="dv">2</span><span class="op">],</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">void</span> addEdge<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  nxt<span class="op">[</span>cnt<span class="op">]</span> <span class="op">=</span> pre<span class="op">[</span>x<span class="op">];</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  to<span class="op">[</span>pre<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> cnt<span class="op">++]</span> <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  nxt<span class="op">[</span>cnt<span class="op">]</span> <span class="op">=</span> pre<span class="op">[</span>y<span class="op">];</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  to<span class="op">[</span>pre<span class="op">[</span>y<span class="op">]</span> <span class="op">=</span> cnt<span class="op">++]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> M <span class="op">=</span> N <span class="op">*</span> N <span class="op">*</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> lc<span class="op">[</span>M<span class="op">],</span> rc<span class="op">[</span>M<span class="op">],</span> pool<span class="op">[</span>M<span class="op">],</span> cnt2<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Msg<span class="op">{</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// (a, b) -&gt; (x + y * a, b + z + w * a)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  Msg<span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">int</span> y <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">int</span> z <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">int</span> w <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">:</span> x<span class="op">(</span>x<span class="op">),</span> y<span class="op">(</span>y<span class="op">),</span> z<span class="op">(</span>z<span class="op">),</span> w<span class="op">(</span>w<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inline</span> <span class="kw">friend</span> Msg <span class="kw">operator</span><span class="op">+(</span><span class="at">const</span> Msg <span class="op">&amp;</span>a<span class="op">,</span> <span class="at">const</span> Msg <span class="op">&amp;</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (a, b)</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// -&gt; (x1 + y1 * a, b + z1 + w1 * a)</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// -&gt; (x2 + y2 * x1 + y2 * y1 * a, b + z1 + w1 * a + z2 + w2 * x1 + w2 * y1 * a)</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  = ((x2 + y2 * x1) + (y2 * y1) * a, b + (z1 + z2 + w2 * x1) + (w1 + w2 * y1) * a)</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Msg<span class="op">(</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">((</span>LL<span class="op">)</span>a<span class="op">.</span>x <span class="op">*</span> b<span class="op">.</span>y <span class="op">+</span> b<span class="op">.</span>x<span class="op">)</span> <span class="op">%</span> mod<span class="op">,</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>LL<span class="op">)</span>a<span class="op">.</span>y <span class="op">*</span> b<span class="op">.</span>y <span class="op">%</span> mod<span class="op">,</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>a<span class="op">.</span>z <span class="op">+</span> b<span class="op">.</span>z <span class="op">+</span> <span class="op">(</span>LL<span class="op">)</span>b<span class="op">.</span>w <span class="op">*</span> a<span class="op">.</span>x<span class="op">)</span> <span class="op">%</span> mod<span class="op">,</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>a<span class="op">.</span>w <span class="op">+</span> <span class="op">(</span>LL<span class="op">)</span>b<span class="op">.</span>w <span class="op">*</span> a<span class="op">.</span>y<span class="op">)</span> <span class="op">%</span> mod<span class="op">);</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inline</span> Msg<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">+=(</span><span class="at">const</span> Msg <span class="op">&amp;</span>a<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span> <span class="op">=</span> <span class="op">*</span><span class="kw">this</span> <span class="op">+</span> a<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> msgv<span class="op">[</span>M<span class="op">];</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> newNode<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> t <span class="op">=</span> pool<span class="op">[</span>cnt2<span class="op">++];</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  lc<span class="op">[</span>t<span class="op">]</span> <span class="op">=</span> rc<span class="op">[</span>t<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> msgv<span class="op">[</span>t<span class="op">]</span> <span class="op">=</span> Msg<span class="op">();</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> t<span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">void</span> delNode<span class="op">(</span><span class="dt">int</span> t<span class="op">)</span> <span class="op">{</span> pool<span class="op">[--</span>cnt2<span class="op">]</span> <span class="op">=</span> t<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> pushd<span class="op">(</span><span class="dt">int</span> o<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>lc<span class="op">[</span>o<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> lc<span class="op">[</span>o<span class="op">]</span> <span class="op">=</span> newNode<span class="op">();</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>rc<span class="op">[</span>o<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> rc<span class="op">[</span>o<span class="op">]</span> <span class="op">=</span> newNode<span class="op">();</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  msgv<span class="op">[</span>lc<span class="op">[</span>o<span class="op">]]</span> <span class="op">+=</span> msgv<span class="op">[</span>o<span class="op">];</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  msgv<span class="op">[</span>rc<span class="op">[</span>o<span class="op">]]</span> <span class="op">+=</span> msgv<span class="op">[</span>o<span class="op">];</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  msgv<span class="op">[</span>o<span class="op">]</span> <span class="op">=</span> Msg<span class="op">();</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> modify<span class="op">(</span><span class="dt">int</span> o<span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">,</span> <span class="dt">int</span> L<span class="op">,</span> <span class="dt">int</span> R<span class="op">,</span> <span class="at">const</span> Msg <span class="op">&amp;</span>m<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>r <span class="op">&lt;</span> L <span class="op">||</span> R <span class="op">&lt;</span> l<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>L <span class="op">&lt;=</span> l <span class="op">&amp;&amp;</span> r <span class="op">&lt;=</span> R<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    msgv<span class="op">[</span>o<span class="op">]</span> <span class="op">+=</span> m<span class="op">;</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    pushd<span class="op">(</span>o<span class="op">);</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    modify<span class="op">(</span>lc<span class="op">[</span>o<span class="op">],</span> l<span class="op">,</span> mid<span class="op">,</span> L<span class="op">,</span> R<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    modify<span class="op">(</span>rc<span class="op">[</span>o<span class="op">],</span> mid <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> r<span class="op">,</span> L<span class="op">,</span> R<span class="op">,</span> m<span class="op">);</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> delTree<span class="op">(</span><span class="dt">int</span> o<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>o <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    delTree<span class="op">(</span>lc<span class="op">[</span>o<span class="op">]);</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    delTree<span class="op">(</span>rc<span class="op">[</span>o<span class="op">]);</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    delNode<span class="op">(</span>o<span class="op">);</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sumv<span class="op">(</span><span class="dt">int</span> o<span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>l <span class="op">==</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> msgv<span class="op">[</span>o<span class="op">].</span>z<span class="op">;</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    pushd<span class="op">(</span>o<span class="op">);</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>sumv<span class="op">(</span>lc<span class="op">[</span>o<span class="op">],</span> l<span class="op">,</span> mid<span class="op">)</span> <span class="op">+</span> sumv<span class="op">(</span>rc<span class="op">[</span>o<span class="op">],</span> mid <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> r<span class="op">))</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> merge<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>y <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> x <span class="op">=</span> y<span class="op">;</span> <span class="cf">return</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>lc<span class="op">[</span>x<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> rc<span class="op">[</span>x<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="bu">std::</span>swap<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>lc<span class="op">[</span>y<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> rc<span class="op">[</span>y<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    msgv<span class="op">[</span>x<span class="op">].</span>z <span class="op">=</span> <span class="op">(</span>msgv<span class="op">[</span>x<span class="op">].</span>z <span class="op">+</span> msgv<span class="op">[</span>y<span class="op">].</span>z<span class="op">)</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    msgv<span class="op">[</span>x<span class="op">].</span>y <span class="op">=</span> <span class="op">(</span>LL<span class="op">)</span>msgv<span class="op">[</span>x<span class="op">].</span>y <span class="op">*</span> msgv<span class="op">[</span>y<span class="op">].</span>x <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    msgv<span class="op">[</span>x<span class="op">].</span>x <span class="op">=</span> <span class="op">(</span>LL<span class="op">)</span>msgv<span class="op">[</span>x<span class="op">].</span>x <span class="op">*</span> msgv<span class="op">[</span>y<span class="op">].</span>x <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    pushd<span class="op">(</span>x<span class="op">);</span> pushd<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    merge<span class="op">(</span>lc<span class="op">[</span>x<span class="op">],</span> lc<span class="op">[</span>y<span class="op">]);</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    merge<span class="op">(</span>rc<span class="op">[</span>x<span class="op">],</span> rc<span class="op">[</span>y<span class="op">]);</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  delNode<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> xx<span class="op">,</span> ansv<span class="op">;</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dp<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> fa<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> ans <span class="op">=</span> newNode<span class="op">();</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  modify<span class="op">(</span>ans<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> Msg<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> pre<span class="op">[</span>x<span class="op">];</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">=</span> nxt<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>to<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> fa<span class="op">)</span> merge<span class="op">(</span>ans<span class="op">,</span> dp<span class="op">(</span>to<span class="op">[</span>i<span class="op">],</span> x<span class="op">));</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>  modify<span class="op">(</span>ans<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> d<span class="op">[</span>x<span class="op">],</span> Msg<span class="op">(</span><span class="dv">0</span><span class="op">,</span> xx<span class="op">));</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  modify<span class="op">(</span>ans<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> Msg<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  modify<span class="op">(</span>ans<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">,</span> Msg<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ans<span class="op">;</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> A<span class="op">[</span>N<span class="op">][</span>N<span class="op">],</span> fac<span class="op">[</span>N<span class="op">],</span> ifac<span class="op">[</span>N<span class="op">],</span> B<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> solve<span class="op">(</span><span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>l <span class="op">==</span> r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> t <span class="op">=</span> <span class="op">(</span>LL<span class="op">)</span>ifac<span class="op">[</span>l<span class="op">]</span> <span class="op">*</span> ifac<span class="op">[</span>n <span class="op">-</span> l<span class="op">]</span> <span class="op">*</span> <span class="op">((</span>n <span class="op">-</span> l<span class="op">)</span> <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span> <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">)</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>      A<span class="op">[</span>l<span class="op">][</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>LL<span class="op">)</span>A<span class="op">[</span>l<span class="op">][</span>i<span class="op">]</span> <span class="op">*</span> t <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> mid <span class="op">=</span> <span class="op">(</span>l <span class="op">+</span> r<span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  memcpy<span class="op">(</span>A<span class="op">[</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">],</span> A<span class="op">[</span>l<span class="op">],</span> <span class="kw">sizeof</span><span class="op">(</span>A<span class="op">[</span>l<span class="op">]));</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> l<span class="op">;</span> i <span class="op">&lt;=</span> mid<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> n<span class="op">;</span> j <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> <span class="op">--</span>j<span class="op">)</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>      A<span class="op">[</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>A<span class="op">[</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span>LL<span class="op">)</span>i <span class="op">*</span> A<span class="op">[</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">])</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    A<span class="op">[</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">-(</span>LL<span class="op">)</span>i <span class="op">*</span> A<span class="op">[</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> mid <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> r<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> n<span class="op">;</span> j <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> <span class="op">--</span>j<span class="op">)</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>      A<span class="op">[</span>l<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>A<span class="op">[</span>l<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span>LL<span class="op">)</span>i <span class="op">*</span> A<span class="op">[</span>l<span class="op">][</span>j<span class="op">])</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    A<span class="op">[</span>l<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="op">-(</span>LL<span class="op">)</span>i <span class="op">*</span> A<span class="op">[</span>l<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>  solve<span class="op">(</span>l<span class="op">,</span> mid<span class="op">);</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>  solve<span class="op">(</span>mid <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> r<span class="op">);</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>  n <span class="op">=</span> readInt<span class="op">();</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>  ifac<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> ifac<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> ifac<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">-</span> <span class="op">(</span>LL<span class="op">)(</span>mod <span class="op">/</span> i<span class="op">)</span> <span class="op">*</span> ifac<span class="op">[</span>mod <span class="op">%</span> i<span class="op">]</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> ifac<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>LL<span class="op">)</span>ifac<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> ifac<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>  A<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>  solve<span class="op">(</span><span class="dv">0</span><span class="op">,</span> n<span class="op">);</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>  k <span class="op">=</span> readInt<span class="op">();</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> k<span class="op">;</span> j <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> B<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> A<span class="op">[</span>i<span class="op">][</span>j<span class="op">];</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    B<span class="op">[</span>i<span class="op">]</span> <span class="op">%=</span> mod<span class="op">;</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>  W <span class="op">=</span> readInt<span class="op">();</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> d<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> readInt<span class="op">();</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>  memset<span class="op">(</span>pre<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span> pre<span class="op">);</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> addEdge<span class="op">(</span>readInt<span class="op">(),</span> readInt<span class="op">());</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> M <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> pool<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    xx <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> t <span class="op">=</span> dp<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> <span class="op">(</span>ans <span class="op">+</span> <span class="op">(</span>LL<span class="op">)</span>sumv<span class="op">(</span>t<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> W<span class="op">)</span> <span class="op">*</span> B<span class="op">[</span>i<span class="op">])</span> <span class="op">%</span> mod<span class="op">;</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    delTree<span class="op">(</span>t<span class="op">);</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span>ans <span class="op">+</span> mod<span class="op">)</span> <span class="op">%</span> mod<span class="op">);</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

        </main>

        <footer>
            ♥ 由
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
            生成！

            © 遵循
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
                CC-BY 4.0
            </a>
            知识共享协议.
        </footer>
    </body>
</html>
